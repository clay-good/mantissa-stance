id: aws-lambda-004
name: Lambda function dead letter queue configured
description: |
  Ensure Lambda functions have a dead letter queue (DLQ) configured for
  asynchronous invocations. DLQ captures failed invocations for later
  analysis and reprocessing, preventing data loss.

enabled: true
severity: medium

resource_type: aws_lambda_function

check:
  type: expression
  expression: "resource.dead_letter_config exists or resource.invocation_type != 'async'"

compliance:
  - framework: nist-800-53
    version: "rev5"
    control: "AU-6"
  - framework: pci-dss
    version: "4.0"
    control: "10.2.1"

remediation:
  guidance: |
    1. Navigate to Lambda in AWS Console
    2. Select the function
    3. Go to Configuration > Asynchronous invocation
    4. Click Edit
    5. Under Dead letter queue service:
       - Select SQS or SNS
       - Choose or create the queue/topic
    6. Save changes

    Note: The Lambda execution role needs sqs:SendMessage or
    sns:Publish permissions for the configured DLQ.
  automation_supported: false

tags:
  - lambda
  - dlq
  - error-handling
  - serverless
  - reliability

references:
  - https://docs.aws.amazon.com/lambda/latest/dg/invocation-async.html
