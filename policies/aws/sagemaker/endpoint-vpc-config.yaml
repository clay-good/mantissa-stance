id: aws-sagemaker-006
name: SageMaker endpoint in VPC
description: |
  Ensure SageMaker endpoints are deployed within a VPC.
  VPC deployment provides network isolation and enables private
  connectivity to the endpoint without internet exposure.

enabled: true
severity: high

resource_type: aws_sagemaker_endpoint

check:
  type: expression
  expression: "resource.vpc_config != null and resource.vpc_config.subnets != null"

compliance:
  - framework: cis-aws-foundations
    version: "1.5.0"
    control: "5.1"
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"
  - framework: pci-dss
    version: "4.0"
    control: "1.3"
  - framework: soc2
    version: "2017"
    control: "CC6.6"

remediation:
  guidance: |
    To deploy SageMaker endpoints in a VPC:
    1. Create a model with VPC configuration:
       - aws sagemaker create-model \
           --model-name my-model \
           --vpc-config SubnetIds=subnet-xxx,SecurityGroupIds=sg-xxx \
           --primary-container ...
    2. Create endpoint configuration using the VPC model
    3. Create or update endpoint with new configuration
    4. Set up VPC endpoints for SageMaker runtime
    5. Configure security groups for endpoint access
  automation_supported: false

tags:
  - sagemaker
  - vpc
  - network
  - endpoint
  - ai-ml
  - inference

references:
  - https://docs.aws.amazon.com/sagemaker/latest/dg/host-vpc.html
  - https://docs.aws.amazon.com/sagemaker/latest/dg/interface-vpc-endpoint.html
