id: k8s-net-009
name: Network policies should specify ports for ingress rules
description: |
  Network policies with ingress rules should specify which ports are
  allowed. Policies without port restrictions allow traffic on all ports,
  which may be more permissive than intended.

enabled: true
severity: medium

resource_type: k8s_network_policy

check:
  type: expression
  expression: |
    (resource.has_ingress_rules == false) or
    (resource.ingress_rules_have_ports == true)

compliance:
  - framework: cis-kubernetes
    version: "1.8.0"
    control: "5.3.2"
  - framework: nist-800-53
    version: "5.0"
    control: "SC-7"

remediation:
  guidance: |
    1. Review the NetworkPolicy ingress rules
    2. Add port specifications to each rule:
       ingress:
       - from:
         - podSelector:
             matchLabels:
               role: frontend
         ports:
         - protocol: TCP
           port: 80
         - protocol: TCP
           port: 443
    3. Only allow the specific ports required by the application
    4. Test connectivity after making changes
  automation_supported: false

tags:
  - kubernetes
  - network-policy
  - ports
  - network-segmentation
  - least-privilege

references:
  - https://kubernetes.io/docs/concepts/services-networking/network-policies/
