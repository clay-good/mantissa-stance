id: k8s-net-005
name: Network policies should not allow traffic from all sources
description: |
  Network policies that allow traffic from all pods or all namespaces
  provide insufficient isolation. Policies should be specific about
  allowed sources to maintain proper network segmentation.

enabled: true
severity: high

resource_type: k8s_network_policy

check:
  type: expression
  expression: "resource.allows_all_ingress == false"

compliance:
  - framework: cis-kubernetes
    version: "1.8.0"
    control: "5.3.2"
  - framework: nist-800-53
    version: "5.0"
    control: "SC-7"

remediation:
  guidance: |
    1. Review the NetworkPolicy ingress rules
    2. Replace overly permissive selectors with specific ones:
       - Replace empty podSelector with specific labels
       - Replace empty namespaceSelector with specific namespaces
    3. Use IP blocks only when necessary and be specific
    4. Example of a specific ingress rule:
       ingress:
       - from:
         - podSelector:
             matchLabels:
               app: frontend
         - namespaceSelector:
             matchLabels:
               name: production
    5. Test connectivity after changes
  automation_supported: false

tags:
  - kubernetes
  - network-policy
  - ingress
  - network-segmentation
  - least-privilege

references:
  - https://kubernetes.io/docs/concepts/services-networking/network-policies/
