id: gcp-logging-010
name: Log metric and alert for Cloud Storage permission changes
description: |
  Ensure a log-based metric and alert exist for Cloud Storage bucket permission
  changes. Storage permission changes can expose sensitive data publicly or
  grant unauthorized access and should be monitored.

enabled: true
severity: high

resource_type: gcp_logging_metric

check:
  type: expression
  expression: "resource.metric_for_storage_permission_changes_exists == true"

compliance:
  - framework: cis-gcp-foundations
    version: "1.3.0"
    control: "2.10"
  - framework: pci-dss
    version: "4.0"
    control: "10.2.5"
  - framework: nist-800-53
    version: "rev5"
    control: "AU-6"

remediation:
  guidance: |
    1. Go to GCP Console > Logging > Log-based Metrics
    2. Click Create Metric
    3. Set filter:
       resource.type="gcs_bucket" AND
       protoPayload.methodName="storage.setIamPermissions"
    4. Create the metric
    5. Go to Monitoring > Alerting
    6. Create alerting policy based on the metric
    7. Configure immediate notification for data protection team
  automation_supported: false

tags:
  - logging
  - monitoring
  - alerting
  - cloud-storage
  - data-protection

references:
  - https://cloud.google.com/storage/docs/access-control/iam
