id: gcp-iam-002
name: Default compute service account not used
description: |
  Ensure the default Compute Engine service account is not used for VMs.
  The default service account has broad permissions that violate the
  principle of least privilege. Use dedicated service accounts instead.

enabled: true
severity: high

resource_type: gcp_compute_instance

check:
  type: expression
  expression: "resource.uses_default_service_account == false"

benchmark:
  - cis-gcp: "1.6"

remediation:
  guidance: |
    1. Create a new service account with minimal required permissions
    2. Navigate to Compute Engine > VM instances
    3. Stop the VM instance
    4. Edit the instance configuration
    5. Under "Identity and API access", change the service account
    6. Select the new dedicated service account
    7. Restart the VM instance
  automation_supported: false

tags:
  - iam
  - service-account
  - least-privilege
  - compute
  - gcp

references:
  - https://cloud.google.com/compute/docs/access/service-accounts
  - https://cloud.google.com/iam/docs/best-practices-for-using-service-accounts
