id: gcp-functions-004
name: Cloud Function uses custom service account
description: |
  Ensure Cloud Functions use custom service accounts instead of the
  default compute service account. Custom service accounts enable
  least-privilege access control for function permissions.

enabled: true
severity: medium

resource_type: gcp_cloud_function

check:
  type: expression
  expression: "resource.uses_default_service_account == false"

compliance:
  - framework: cis-gcp-foundations
    version: "1.3.0"
    control: "7.1"
  - framework: nist-800-53
    version: "rev5"
    control: "AC-6"
  - framework: pci-dss
    version: "4.0"
    control: "7.2.1"

remediation:
  guidance: |
    1. Create a custom service account:
       - gcloud iam service-accounts create FUNCTION_SA
    2. Grant only necessary permissions to the service account
    3. Navigate to Cloud Functions in Console
    4. Select the function
    5. Click Edit
    6. Under Runtime service account:
       - Select the custom service account
    7. Deploy the function

    Best practice: Create separate service accounts for each
    function or group of related functions.
  automation_supported: false

tags:
  - functions
  - iam
  - service-account
  - serverless
  - least-privilege

references:
  - https://cloud.google.com/functions/docs/securing/function-identity
