id: gcp-functions-001
name: Cloud Function VPC connector configured
description: |
  Ensure Cloud Functions that access private resources use VPC connectors.
  VPC connectors enable functions to access resources in private VPCs
  without exposing them to the public internet.

enabled: true
severity: medium

resource_type: gcp_cloud_function

check:
  type: expression
  expression: "resource.vpc_connector exists or resource.requires_vpc_access == false"

compliance:
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"
  - framework: pci-dss
    version: "4.0"
    control: "1.3.1"

remediation:
  guidance: |
    1. Navigate to Cloud Functions in Google Cloud Console
    2. Select the function
    3. Click Edit
    4. Under Networking:
       - Select "Allow internal traffic only" or
       - Configure VPC connector
    5. Choose or create a VPC connector
    6. Select egress settings:
       - Route all traffic through VPC connector, or
       - Route only private IP traffic
    7. Deploy the function
  automation_supported: false

tags:
  - functions
  - vpc
  - network
  - serverless
  - isolation

references:
  - https://cloud.google.com/functions/docs/networking/connecting-vpc
