id: gcp-compute-006
name: Database ports not exposed to internet
description: |
  Ensure firewall rules do not allow database port access from the
  internet (0.0.0.0/0). Exposing database ports like MySQL (3306),
  PostgreSQL (5432), Redis (6379), MongoDB (27017) creates significant
  security risks.

enabled: true
severity: critical

resource_type: gcp_compute_firewall

check:
  type: expression
  expression: "resource.allows_database_from_internet == false"

compliance:
  - framework: cis-gcp-foundations
    version: "2.0.0"
    control: "3.8"
  - framework: pci-dss
    version: "4.0"
    control: "1.3.1"
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"

remediation:
  guidance: |
    1. Navigate to VPC Network > Firewall in GCP Console
    2. Identify rules allowing database ports from 0.0.0.0/0:
       - Port 3306 (MySQL)
       - Port 5432 (PostgreSQL)
       - Port 6379 (Redis)
       - Port 27017 (MongoDB)
       - Port 9200 (Elasticsearch)
    3. Edit rules to restrict source ranges
    4. Use service accounts or tags for source filtering
    5. Consider Private Service Connect for database access
  automation_supported: false

tags:
  - compute
  - firewall
  - database
  - network-security
  - gcp

references:
  - https://cloud.google.com/vpc/docs/firewalls
  - https://cloud.google.com/sql/docs/mysql/connect-overview
