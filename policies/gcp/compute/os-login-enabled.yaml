id: gcp-compute-002
name: OS Login enabled
description: |
  Ensure OS Login is enabled on Compute Engine instances. OS Login
  provides centralized SSH key management through Cloud IAM, replacing
  metadata-based SSH keys and providing better access control and auditing.

enabled: true
severity: medium

resource_type: gcp_compute_instance

check:
  type: expression
  expression: "resource.os_login_enabled == true"

compliance:
  - framework: cis-gcp-foundations
    version: "2.0.0"
    control: "4.4"
  - framework: nist-800-53
    version: "rev5"
    control: "IA-2"

remediation:
  guidance: |
    1. Navigate to Compute Engine > VM instances
    2. Select the instance
    3. Click Edit
    4. Under Metadata, add "enable-oslogin" = "TRUE"
    5. Save the changes
    6. Grant users roles/compute.osLogin or roles/compute.osAdminLogin
    7. Consider enabling organization-wide via organization policy
  automation_supported: false

tags:
  - compute
  - os-login
  - ssh
  - access-control
  - gcp

references:
  - https://cloud.google.com/compute/docs/oslogin
  - https://cloud.google.com/compute/docs/instances/managing-instance-access
