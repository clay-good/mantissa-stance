id: gcp-sql-008
name: Cloud SQL deletion protection enabled
description: |
  Ensure Cloud SQL instances have deletion protection enabled.
  Deletion protection prevents accidental or unauthorized deletion
  of production databases through the console, CLI, or API.

enabled: true
severity: high

resource_type: gcp_cloudsql_instance

check:
  type: expression
  expression: "resource.deletion_protection == true"

compliance:
  - framework: nist-800-53
    version: "rev5"
    control: "SC-28"
  - framework: pci-dss
    version: "4.0"
    control: "9.4.5"

remediation:
  guidance: |
    1. Navigate to Cloud SQL in Google Cloud Console
    2. Select the instance
    3. Click Edit
    4. Under Data protection:
       - Enable "Enable deletion protection"
    5. Save changes

    To delete a protected instance, you must first disable
    deletion protection.
  automation_supported: false

tags:
  - sql
  - cloudsql
  - deletion-protection
  - database
  - data-protection

references:
  - https://cloud.google.com/sql/docs/mysql/deletion-protection
