id: gcp-sql-002
name: Cloud SQL instance public IP disabled
description: |
  Ensure Cloud SQL database instances do not have public IP addresses.
  Public IPs expose the database to internet-based attacks. Use private
  IP with VPC peering or Cloud SQL Proxy for secure access.

enabled: true
severity: critical

resource_type: gcp_cloudsql_instance

check:
  type: expression
  expression: "resource.has_public_ip == false"

compliance:
  - framework: cis-gcp-foundations
    version: "1.3.0"
    control: "6.6"
  - framework: pci-dss
    version: "4.0"
    control: "1.3.1"
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"

remediation:
  guidance: |
    1. Navigate to Cloud SQL in Google Cloud Console
    2. Select the instance
    3. Click Edit
    4. Under Connectivity:
       - Disable "Public IP"
       - Enable "Private IP" if not already enabled
       - Configure VPC network for private access
    5. Save changes

    Note: Ensure applications use Cloud SQL Proxy or VPC peering
    to connect to the private IP.
  automation_supported: false

tags:
  - sql
  - cloudsql
  - network
  - database
  - public-access

references:
  - https://cloud.google.com/sql/docs/mysql/configure-private-ip
