id: azure-identity-009
name: Legacy authentication blocked
description: |
  Ensure legacy authentication protocols are blocked. Legacy protocols
  like POP, IMAP, SMTP auth, and older Office clients do not support
  MFA and are commonly exploited in password spray attacks.

enabled: true
severity: high

resource_type: azure_conditional_access_policy

check:
  type: expression
  expression: "resource.blocks_legacy_auth == true"

compliance:
  - framework: cis-azure-foundations
    version: "2.0.0"
    control: "1.1.3"
  - framework: nist-800-53
    version: "rev5"
    control: "IA-2"
  - framework: pci-dss
    version: "4.0"
    control: "8.3.1"

remediation:
  guidance: |
    1. Navigate to Azure Active Directory > Security > Conditional Access
    2. Create a new policy named "Block legacy authentication"
    3. Under "Assignments > Users":
       - Include "All users"
       - Exclude service accounts that require legacy auth
    4. Under "Cloud apps or actions":
       - Include "All cloud apps"
    5. Under "Conditions > Client apps":
       - Configure "Yes"
       - Select "Exchange ActiveSync clients" and "Other clients"
    6. Under "Access controls > Grant":
       - Select "Block access"
    7. Enable the policy
  automation_supported: false

tags:
  - identity
  - legacy-auth
  - conditional-access
  - authentication
  - azure

references:
  - https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/block-legacy-authentication
  - https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/concept-conditional-access-conditions
