id: azure-sql-005
name: Azure SQL public network access disabled
description: |
  Ensure Azure SQL Server public network access is disabled. Disabling
  public network access forces all connections through private endpoints,
  reducing the attack surface.

enabled: true
severity: critical

resource_type: azure_sql_server

check:
  type: expression
  expression: "resource.public_network_access == 'Disabled'"

compliance:
  - framework: cis-azure-foundations
    version: "2.0.0"
    control: "4.1.2"
  - framework: pci-dss
    version: "4.0"
    control: "1.3.1"
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"

remediation:
  guidance: |
    1. Navigate to SQL Server in Azure Portal
    2. Under Security, select Networking
    3. Set "Public network access" to Disabled
    4. Configure Private endpoints:
       - Create private endpoint in your VNet
       - Configure DNS for private link
    5. Save changes

    Note: Ensure applications can connect through private
    endpoints before disabling public access.
  automation_supported: false

tags:
  - sql
  - azure-sql
  - network
  - database
  - private-endpoint

references:
  - https://docs.microsoft.com/en-us/azure/azure-sql/database/connectivity-architecture
