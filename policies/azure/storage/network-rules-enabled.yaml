id: azure-storage-004
name: Network access restricted
description: |
  Ensure storage accounts restrict network access. By default, storage
  accounts accept connections from all networks. Configuring network
  rules to deny access by default improves security posture.

enabled: true
severity: high

resource_type: azure_storage_account

check:
  type: expression
  expression: "resource.allows_public_network_access == false"

compliance:
  - framework: cis-azure-foundations
    version: "2.0.0"
    control: "3.6"
  - framework: pci-dss
    version: "4.0"
    control: "1.3.1"
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"

remediation:
  guidance: |
    1. Navigate to Storage accounts in Azure Portal
    2. Select the storage account
    3. Go to Networking under Security + networking
    4. Under Firewalls and virtual networks, select "Enabled from selected
       virtual networks and IP addresses"
    5. Add allowed virtual networks and IP ranges
    6. Consider using private endpoints for secure access
    7. Save the configuration
  automation_supported: false

tags:
  - storage
  - network
  - firewall
  - access-control
  - azure

references:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-network-security
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-private-endpoints
