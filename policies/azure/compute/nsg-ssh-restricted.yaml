id: azure-compute-001
name: SSH access restricted from internet
description: |
  Ensure Network Security Groups do not allow SSH (port 22) access from
  the internet (*/Internet). Unrestricted SSH access exposes VMs to
  brute force attacks and should be limited to specific trusted IPs.

enabled: true
severity: high

resource_type: azure_network_security_group

check:
  type: expression
  expression: "resource.allows_ssh_from_internet == false"

compliance:
  - framework: cis-azure-foundations
    version: "2.0.0"
    control: "6.1"
  - framework: pci-dss
    version: "4.0"
    control: "1.3.1"
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"

remediation:
  guidance: |
    1. Navigate to Network security groups in Azure Portal
    2. Select the NSG with SSH allowed from internet
    3. Go to Inbound security rules
    4. Edit or delete the rule allowing SSH from Any/*
    5. Create a rule allowing SSH only from specific IP ranges
    6. Consider using Azure Bastion for secure SSH access
    7. Or use Just-In-Time VM access through Defender for Cloud
  automation_supported: false

tags:
  - compute
  - nsg
  - ssh
  - network-security
  - azure

references:
  - https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview
  - https://docs.microsoft.com/en-us/azure/bastion/bastion-overview
