id: azure-compute-005
name: Database ports not exposed to internet
description: |
  Ensure Network Security Groups do not allow database port access
  from the internet. Exposing database ports like SQL Server (1433),
  MySQL (3306), PostgreSQL (5432) creates significant security risks.

enabled: true
severity: critical

resource_type: azure_network_security_group

check:
  type: expression
  expression: "resource.allows_database_from_internet == false"

compliance:
  - framework: cis-azure-foundations
    version: "2.0.0"
    control: "6.3"
  - framework: pci-dss
    version: "4.0"
    control: "1.3.1"
  - framework: nist-800-53
    version: "rev5"
    control: "SC-7"

remediation:
  guidance: |
    1. Navigate to Network Security Groups in Azure Portal
    2. Select the NSG with exposed database ports
    3. Go to Inbound security rules
    4. Identify rules allowing database ports from Any/Internet:
       - Port 1433 (SQL Server)
       - Port 3306 (MySQL)
       - Port 5432 (PostgreSQL)
       - Port 6379 (Redis)
       - Port 27017 (MongoDB)
    5. Modify rules to restrict source to specific VNet/subnet
    6. Consider using Private Endpoints for database access
  automation_supported: false

tags:
  - compute
  - nsg
  - database
  - network-security
  - azure

references:
  - https://docs.microsoft.com/en-us/azure/virtual-network/network-security-groups-overview
  - https://docs.microsoft.com/en-us/azure/azure-sql/database/connectivity-architecture
